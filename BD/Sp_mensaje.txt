-- MENSAJE
delimiter //
use CHAT//

drop procedure if exists sp_insertar_mensaje//
drop procedure if exists sp_mostrar_mensajes//
drop procedure if exists sp_buscar_mensaje//
drop procedure if exists sp_mensaje_activo//
drop procedure if exists sp_mensaje_leido//
drop procedure if exists sp_vaciar_chat//

CREATE PROCEDURE sp_insertar_mensaje(_id_cuenta int,_id_sala int,_mensaje text,_fecha datetime) 
BEGIN
	INSERT INTO MENSAJE (id_cuenta,id_sala,mensaje,fecha,activo,leido) 
	VALUES(_id_cuenta,_id_sala,_mensaje,_fecha,true,false);
END//

CREATE PROCEDURE sp_mostrar_mensajes(_id_sala int)
BEGIN
	SELECT * FROM MENSAJE WHERE id_sala=_id_sala;
END//

CREATE PROCEDURE sp_buscar_mensaje(_id_cuenta int,_mensaje text)
BEGIN
	SELECT * FROM MENSAJE WHERE id_cuenta=_id_cuenta AND mensaje LIKE _mensaje;
END//
CREATE PROCEDURE sp_mensaje_activo(_id_mensaje int, _activo bool)
BEGIN
	UPDATE MENSAJE SET activo=_activo WHERE id_mensaje=_id_mensaje;
END//
CREATE PROCEDURE sp_mensaje_leido(_id_mensaje int, _leido bool)
BEGIN
	UPDATE MENSAJE SET leido=_leido WHERE id_mensaje=_id_mensaje;
END//
CREATE PROCEDURE sp_vaciar_chat(_id_sala int)
BEGIN
	UPDATE MENSAJE SET activo=false WHERE id_sala=_id_sala;
END//


